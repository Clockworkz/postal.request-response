/**
 * postal.request-response - postal.js add-on that provides a request/response pattern API.
 * Author: Jim Cowart (http://freshbrewedcode.com/jimcowart)
 * Version: v0.1.0
 * Url: http://github.com/postaljs/postal.request-response.js
 * License(s): MIT
 */
(function(e,r){"object"==typeof module&&module.exports?module.exports=function(e){return r(require("underscore"),e,this)}:"function"==typeof define&&define.amd?define(["underscore","postal"],function(t,n){return r(t,n,e)}):e.postal=r(e._,e.postal,e)})(this,function(e,r){var t="postal.request-response",n=function(){for(var e={},r=[],t=0;256>t;t++)r[t]=(16>t?"0":"")+t.toString(16);return e.create=function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return r[255&e]+r[e>>8&255]+r[e>>16&255]+r[e>>24&255]+"-"+r[255&t]+r[t>>8&255]+"-"+r[t>>16&15|64]+r[t>>24&255]+"-"+r[63&n|128]+r[n>>8&255]+"-"+r[n>>16&255]+r[n>>24&255]+r[255&o]+r[o>>8&255]+r[o>>16&255]+r[o>>24&255]},e}();r.ChannelDefinition.prototype.request=function(e){var o,a=e.envelope?e.envelope:{topic:e.topic,data:e.data},i=n.create(),s=e.replyTopic||i,u=e.replyChannel||t;a.headers=a.headers||{},a.headers.replyable=!0,a.headers.requestId=i,a.headers.replyTopic=s,a.headers.replyChannel=u;r.subscribe({channel:u,topic:s,callback:e.onReply}).once();return e.timeout&&e.onTimeout&&(o=setTimeout(function(){e.onTimeout()},e.timeout)),this.publish(a)};var o=r.publish;return r.publish=function(e){e.headers&&e.headers.replyable&&(e.reply=function(t){r.publish({channel:e.headers.replyChannel,topic:e.headers.replyTopic,headers:{isReply:!0,requestId:e.headers.requestId},data:t})}),o.call(this,e)},r});